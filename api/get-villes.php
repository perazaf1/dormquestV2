<?php
// api/get-villes.php - Récupère les suggestions de villes
header('Content-Type: application/json; charset=utf-8');

// Liste complète des principales villes de France avec leur population approximative
$villes_data = [
    'Paris' => 2161000,
    'Marseille' => 869000,
    'Lyon' => 526000,
    'Toulouse' => 479000,
    'Nice' => 340000,
    'Nantes' => 309000,
    'Strasbourg' => 284000,
    'Montpellier' => 285000,
    'Bordeaux' => 254000,
    'Lille' => 233000,
    'Rennes' => 221000,
    'Reims' => 183000,
    'Le Havre' => 172000,
    'Saint-Étienne' => 171000,
    'Toulon' => 169000,
    'Grenoble' => 160000,
    'Angers' => 157000,
    'Dijon' => 158000,
    'Nîmes' => 151000,
    'Aix-en-Provence' => 146000,
    'Saint-Denis' => 108000,
    'Le Mans' => 142000,
    'Clermont-Ferrand' => 142000,
    'Amiens' => 134000,
    'Limoges' => 120000,
    'Tours' => 139000,
    'Villeurbanne' => 148000,
    'Metz' => 118000,
    'Albi' => 49000,
    'Dunkerque' => 88000,
    'Brest' => 139000,
    'Orléans' => 116000,
    'Avignon' => 92000,
    'Perpignan' => 118000,
    'Besançon' => 116000,
    'Rouen' => 110000,
    'Nancy' => 105000,
    'Caen' => 105000,
    'Bayonne' => 49000,
    'Boulogne-Billancourt' => 117000,
    'Montreuil' => 108000,
    'Antibes' => 75000,
    'Aubervilliers' => 87000,
    'Nanterre' => 95000,
    'Colombes' => 87000,
    'Argenteuil' => 107000,
    'Vitry-sur-Seine' => 86000,
    'Champigny-sur-Marne' => 76000,
    'Cannes' => 74000,
    'Versailles' => 88000,
    'Neuilly-sur-Seine' => 63000,
    'Issy-les-Moulineaux' => 69000,
    'Courbevoie' => 89000,
    'Asnières-sur-Seine' => 85000,
    'Rueil-Malmaison' => 79000,
    'Saint-Maur-des-Fossés' => 75000,
    'Créteil' => 95000,
    'Ivry-sur-Seine' => 61000,
    'Maisons-Alfort' => 54000,
    'Cachan' => 37000,
    'Bagneux' => 37000,
    'Montrouge' => 49000,
    'Vanves' => 29000,
    'Malakoff' => 33000,
    'Clamart' => 50000,
    'Fontenay-aux-Roses' => 26000,
    'Sèvres' => 30000,
    'Meudon' => 47000,
    'Chaville' => 19000,
    'Saint-Cloud' => 30000,
    'Garches' => 18000,
    'Vaucresson' => 10000,
    'Marnes-la-Coquette' => 6000,
    'La Celle-Saint-Cloud' => 12000,
    'Rocquencourt' => 600,
    'Vélizy-Villacoublay' => 27000,
    'Saint-Cyr-l\'École' => 17000,
    'Louveciennes' => 8000,
    'Medan' => 6000,
    'Chatou' => 31000,
    'Croissy-sur-Seine' => 17000,
    'Le Pecq' => 16000,
    'Carrières-sur-Seine' => 15000,
    'Saint-Germain-en-Laye' => 44000,
    'Maisons-Laffitte' => 24000,
    'Saint-Nom-la-Bretèche' => 5000,
    'Poissy' => 38000,
    'Triel-sur-Seine' => 12000,
    'Éragny' => 30000,
    'Osny' => 15000,
    'Pontoise' => 32000,
    'Vauréal' => 15000,
    'Cergy' => 63000,
    'Neuville-sur-Oise' => 19000,
    'Saint-Ouen-l\'Aumône' => 24000,
    'Maurecourt' => 7000,
    'Limay' => 15000,
    'Meulan' => 11000,
    'Aubergenville' => 13000,
    'Conflans-Sainte-Honorine' => 35000,
    'La Frette-sur-Seine' => 12000,
    'Herblay' => 28000,
    'Montfort-l\'Amaury' => 9000,
    'Chevreuse' => 6000,
    'Dampierre-en-Yvelines' => 6000,
    'Saint-Rémy-lès-Chevreuse' => 6000,
    'Rambouillet' => 26000,
    'Dourdan' => 8000,
    'Milly-la-Forêt' => 4000,
    'Fontainebleau' => 15000,
    'Melun' => 51000,
    'Provins' => 12000,
    'Moret-sur-Loing' => 4000,
    'Nemours' => 13000,
    'Montereau-Fault-Yonne' => 18000,
    'Montargis' => 18000,
    'Pithiviers' => 8000,
    'Gien' => 14000,
    'Briare' => 5000,
    'Cosne-Cours-sur-Loire' => 10000,
    'Auxerre' => 36000,
    'Sens' => 27000,
    'Joigny' => 10000,
    'Villeneuve-sur-Yonne' => 5000,
    'Tonnerre' => 5000,
    'Chatillon-sur-Seine' => 7000,
    'Montbard' => 7000,
    'Semur-en-Auxois' => 4000,
    'Avallon' => 7000,
    'Vézelay' => 450,
    'La Rochelle' => 76000,
    'Royan' => 19000,
    'Cognac' => 19000,
    'Saintes' => 25000,
    'Saint-Jean-d\'Angély' => 8000,
    'Rochefort' => 26000,
    'Marennes' => 5000,
    'Angoulême' => 40000,
    'Barbezieux-Saint-Hilaire' => 13000,
    'Jarnac' => 4000,
    'Segonzac' => 3000,
    'Poitiers' => 88000,
    'Châtellerault' => 32000,
    'Loudun' => 7000,
    'Montmorillon' => 7000,
    'Civray' => 3000,
    'Saint-Maixent-l\'École' => 8000,
    'Niort' => 58000,
    'Brioux-sur-Boutonne' => 3000,
    'Parthenay' => 11000,
    'Thouars' => 9000,
    'Argenton-Château' => 2000,
    'Limoges' => 120000,
    'Guéret' => 14000,
    'Aubusson' => 4000,
    'Bellac' => 4000,
    'Saint-Léonard-de-Noblat' => 5000,
    'Rochechouart' => 4000,
    'Eymoutiers' => 2000,
    'Saint-Yrieix-la-Perche' => 7000,
    'Périgueux' => 30000,
    'Bergerac' => 28000,
    'Sarlat-la-Canéda' => 9000,
    'Nontron' => 3000,
    'Ribérac' => 4000,
    'Eymet' => 3000,
    'Domme' => 1000,
    'La Roque-Gageac' => 500,
    'Beynac-et-Cazenac' => 500,
    'Fumel' => 5000,
    'Cahors' => 20000,
    'Figeac' => 10000,
    'Gramat' => 3000,
    'Gourdon' => 4000,
    'Martel' => 1000,
    'Padirac' => 200,
    'Saint-Céré' => 3000,
    'Rocamadour' => 600,
    'Souillac' => 3000,
    'Agen' => 34000,
    'Villeneuve-sur-Lot' => 23000,
    'Marmande' => 18000,
    'Nérac' => 7000,
    'Sos' => 300,
    'Penne-d\'Agenais' => 2000,
    'Clairac' => 1000,
    'Tonneins' => 10000,
    'Aiguillon' => 4000,
    'Castelmoron-sur-Lot' => 1000,
    'Auch' => 22000,
    'Condom' => 7000,
    'Lectoure' => 4000,
    'Samatan' => 2000,
    'L\'Isle-Jourdain' => 8000,
    'Gimont' => 3000,
    'Mirande' => 4000,
    'Fleurance' => 6000,
    'Nogaro' => 2000,
    'Eauze' => 4000,
    'Tarbes' => 40000,
    'Lourdes' => 15000,
    'Pau' => 77000,
    'Bayonne' => 49000,
    'Dax' => 21000,
    'Saint-Gaudens' => 11000,
    'Bagnères-de-Bigorre' => 8000,
    'Saint-Pé-de-Bigorre' => 600,
    'Bagnères-de-Luchon' => 3000,
    'Saint-Girons' => 7000,
    'Ax-les-Thermes' => 1000,
    'Tarascon-sur-Ariège' => 3000,
    'Foix' => 10000,
    'Pamiers' => 15000,
    'Lavelanet' => 3000,
    'Castres' => 44000,
    'Gaillac' => 11000,
    'Lavaur' => 8000,
    'Réalmont' => 3000,
    'Labruguière' => 6000,
    'Mazamet' => 10000,
    'Revel' => 2000,
    'Sorèze' => 2000,
    'Montauban' => 58000,
    'Castelsarrasin' => 43000,
    'Moissac' => 12000,
    'Saint-Antonin-Noble-Val' => 2000,
    'Caussade' => 6000,
    'Valence-d\'Agen' => 4000,
    'Lauzerte' => 1000,
    'Auvillar' => 900,
    'Béziers' => 76000,
    'Sète' => 43000,
    'Mèze' => 11000,
    'Marseillan' => 6000,
    'Agde' => 27000,
    'Pézenas' => 8000,
    'Saint-Chinian' => 2000,
    'Murviel-lès-Béziers' => 4000,
    'Lodève' => 7000,
    'Clermont-l\'Hérault' => 8000,
    'Saint-Guilhem-le-Désert' => 200,
    'Gignac' => 4000,
    'Aniane' => 5000,
    'Lamalou-les-Bains' => 2000,
    'Bédarieux' => 6000,
    'Olargues' => 1000,
    'Carcassonne' => 47000,
    'Narbonne' => 53000,
    'Perpignan' => 118000,
    'Quillan' => 3000,
    'Limoux' => 9000,
    'Couiza' => 1000,
    'Tuchan' => 1000,
    'Montségur' => 75,
    'Mirepoix' => 3000,
    'Prades' => 2000,
    'Saint-Affrique' => 8000,
    'Millau' => 22000,
    'La Cavalerie' => 100,
    'Nant' => 800,
    'Chambéry' => 58000,
    'Annecy' => 128000,
    'Évian-les-Bains' => 8000,
    'Thonon-les-Bains' => 32000,
    'Bonneville' => 12000,
    'Sallanches' => 16000,
    'Chamonix-Mont-Blanc' => 9000,
    'Saint-Gervais-les-Bains' => 5000,
    'Albertville' => 18000,
    'Moûtiers' => 4000,
    'Courchevel' => 2000,
    'Méribel' => 1500,
    'Val-d\'Isère' => 1600,
    'Tignes' => 2500,
    'Bourg-Saint-Maurice' => 7000,
    'Mâcon' => 34000,
    'Villefranche-sur-Saône' => 32000,
    'Belleville' => 8000,
    'Amplepuis' => 6000,
    'Thizy-les-Bourgs' => 2000,
    'Beaujeu' => 2000,
    'Cours' => 4000,
    'Theizé' => 1500,
    'Montluçon' => 37000,
    'Commentry' => 4000,
    'Vichy' => 27000,
    'Cusset' => 14000,
    'Moulins' => 19000,
    'Decize' => 6000,
    'Nevers' => 35000,
    'Troyes' => 61000,
    'Romilly-sur-Seine' => 14000,
    'Meaux' => 54000,
    'Brie-Comte-Robert' => 14000,
];

$villes_disponibles = array_keys($villes_data);



$query = isset($_GET['q']) ? trim($_GET['q']) : '';

// Si la requête est vide, retourner un tableau vide
if (strlen($query) < 1) {
    echo json_encode([]);
    exit();
}

// Supprimer les doublons de la liste des villes
$villes_disponibles = array_unique($villes_disponibles);

// Filtrer les villes qui correspondent à la requête (case-insensitive)
$suggestions = [];
$query_lower = strtolower($query);

foreach ($villes_disponibles as $ville) {
    if (stripos($ville, $query_lower) === 0) { // Commence par la requête
        $suggestions[] = $ville;
    }
}

// Trier les suggestions par population (descendant)
usort($suggestions, function($a, $b) use ($villes_data) {
    $pop_a = isset($villes_data[$a]) ? $villes_data[$a] : 0;
    $pop_b = isset($villes_data[$b]) ? $villes_data[$b] : 0;
    return $pop_b - $pop_a; // Tri décroissant (plus grande population en premier)
});

// Limiter à 10 suggestions
$suggestions = array_slice($suggestions, 0, 10);

echo json_encode($suggestions);



